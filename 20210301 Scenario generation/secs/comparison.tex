\section{Scenario comparison}
\label{sec:comparison}

Ideally, we want to sample the generated scenarios from the same distributions that underlies the real-world scenarios. 
The problem, however, is that the distribution that underlies the real-world scenarios is unknown. 
Although this distribution is unknown, in this section, we propose a metric that quantifies the similarity of the distribution that we use to generate scenarios and the distribution that underlies the real-world scenarios.
In \cref{sec:comparion problem}, we will further explain the goal of this metric.
Our metric will be based on the Wasserstein distance \autocite{ruschendorf1985wasserstein}, which is explained in \cref{sec:wasserstein}.
In \cref{sec:metric scenario generation method}, we will describe how the Wasserstein distance is used to derive our metric.



\subsection{Scenario comparison problem}
\label{sec:comparion problem}

For generating the scenarios, we rely on the set of observed scenarios, described using the parameters $\scenariopars_{\scenarioindex}$, $\scenarioindex \in \{1,\ldots,\scenariosnumberof\}$. 
To ease the notation, let us denote the set of observed scenarios by $\scenarioset = \{\scenariopars_{1}, \ldots, \scenariopars_{\scenariosnumberof}\}$.
We assume that these scenarios are independently and identically distributed according to the distribution $\density{\cdot}$.
Let us denote the set of generated scenarios by $\scenariosetgenerated = \{\scenarioparsgenerated_{1}, \ldots, \scenarioparsgenerated_{\scenariosgeneratednumberof}\}$ where $\scenarioparsgenerated_{\scenarioindex} \in \realnumbers^{\dimensionscenariopars}$, $\scenarioindex \in \{1,\ldots,\scenariosgeneratednumberof\}$ are similarly parameterized as the scenario parameters in \cref{eq:scenario parameters} and $\scenariosgeneratednumberof$ is the number of generated scenarios.
We denote the \ac{pdf} of the generated scenarios by $\densityest{\cdot}$, which is based on $\densityestkde{\bandwidthmatrix}{\cdot}$ of \cref{eq:density est kde}.
Ideally, we want $\densityest{\cdot}$ to be equal to $\density{\cdot}$, so our metric aims to quantify the similarity of $\densityest{\cdot}$ and $\density{\cdot}$.

To estimate the similarity between $\densityest{\cdot}$ and $\density{\cdot}$, we cannot simply compare $\scenariosetgenerated$ with $\scenarioset$.
I.e., in that case, taking $\scenariosetgenerated=\scenarioset$ would give us the best result, but this is not what we want because we want our generated scenarios to cover the whole variety of real-world scenarios and not just the variety that we happened to observe in $\scenarioset$.
So, therefore, we need another set of scenarios that we can use to test.
Let us assume that we have such a set of scenarios, denoted by $\scenariosettest = \{\scenarioparstest_{1},\ldots,\scenarioparstest_{\scenariostestnumberof}\}$ where $\scenarioparstest_{\scenarioindex} \in \realnumbers^{\dimensionscenariopars}$, $\scenarioindex \in \{1, \ldots, \scenariostestnumberof\}$ are independently and identically distributed according to $\density{\cdot}$.

In summary, the goal is to find a metric that quantifies the similarity of $\densityest{\cdot}$ and $\density{\cdot}$ using the sets of observed scenarios $\scenarioset$ and $\scenariosettest$ and the set of generated scenarios $\scenariosetgenerated$.



\subsection{Empirical Wasserstein metric}
\label{sec:wasserstein}

The $\wassersteincoefficient$-th Wasserstein metric ($\wassersteincoefficient \geq 1$) is used to compare two probability distribution functions $\dummydensity(\dummyvar)$ and $\dummydensityb(\dummyvarb)$ with $\dummyvar\in\dummyset$ and $\dummyvarb\in\dummysetb$.
\begin{equation}
	\label{eq:wasserstein}
	\wassersteinp{\wassersteincoefficient}{\dummydensity}{\dummydensityb}
	= \left( 
		\inf_{\dummydensityc \in \dummydensityset(\dummydensity,\dummydensityb)}
		\left\{ 
			\left( \distancefunc{\dummyvar}{\dummyvarb} \right)^{\wassersteincoefficient} 
			\ud \dummydensityc(\dummyvar,\dummyvarb)
		\right\}
	\right)^{1/\wassersteincoefficient}.
\end{equation}
Here, $\distancefunc{\dummyvar}{\dummyvarb}$ denotes the ``distance'' from $\dummyvar$ to $\dummyvarb$ and $\dummydensityset(\dummydensity,\dummydensityb)$ denotes the set of joint distributions of $(\dummyvar, \dummyvarb)$ that has that marginal distributions $\dummydensity(\cdot)$ and $\dummydensityb(\cdot)$. 
Intuitively, this metric calculates the minimum ``cost'' of turning one \ac{pdf} into another \ac{pdf} if these \acp{pdf} are seen as a pile of earth with equal mass. 
Therefore, the Wasserstein metric is also referred to as the earth mover's distance \autocite{rubner2000emd}.

In our case, we want to have a metric to compare $\density{\cdot}$ and $\densityest{\cdot}$.
Because we do not know $\density{\cdot}$ and $\densityest{\cdot}$, we consider their approximations, based on $\scenariosettest$ and $\scenariosetgenerated$, respectively:
\begin{align}
	\density{\scenarioparstest} &\approx
	\frac{1}{\scenariostestnumberof} \sum_{\scenarioindex=1}^{\scenariostestnumberof}
	\dirac{\scenarioparstest - \scenarioparstest_{\scenarioindex}}, \label{eq:empirical density}\\
	\densityest{\scenarioparsgenerated} &\approx
	\frac{1}{\scenariosgeneratednumberof} \sum_{\scenarioindex=1}^{\scenariosgeneratednumberof}
	\dirac{\scenarioparsgenerated - \scenarioparsgenerated_{\scenarioindex}}, \label{eq:empirical density estimation}
\end{align}
where $\dirac{\cdot}$ denotes the Dirac delta function.
Substituting the empirical estimations of \cref{eq:empirical density,eq:empirical density estimation} for $\dummydensity(\cdot)$ and $\dummydensityb(\cdot)$, respectively, into \cref{eq:wasserstein}, leads to the so-called empirical Wasserstein metric \autocite{sommerfeld2018inference}, which we define as:
\begin{equation}
	\label{eq:empirical wasserstein}
	\wasserstein{\scenariosettest}{\scenariosetgenerated}
	= \inf_{\transportmatrix} 
	\sum_{\sumindex=1}^{\scenariostestnumberof} \sum_{\sumindexb=1}^{\scenariosgeneratednumberof} 
	\distancefunc{\scenarioparstest_{\sumindex}}{\scenarioparsgenerated_{\sumindexb}}
	\transportmatrixelement{\sumindex}{\sumindexb},
\end{equation}
subject to the following constraints:
\begin{alignat}{2}
	\sum_{\sumindex=1}^{\scenariostestnumberof} \transportmatrixelement{\sumindex}{\sumindexb} &= \frac{1}{\scenariosgeneratednumberof} \quad && \forall \sumindexb \in \{1,\ldots,\scenariosgeneratednumberof\}, \\
	\sum_{\sumindexb=1}^{\scenariosgeneratednumberof} \transportmatrixelement{\sumindex}{\sumindexb} &= \frac{1}{\scenariostestnumberof} \quad && \forall \sumindex \in \{1,\ldots,\scenariostestnumberof\}, \\
	\transportmatrixelement{\sumindex}{\sumindexb} &\geq 0 \quad && \forall \sumindex \in \{1,\ldots,\scenariostestnumberof\}, \forall \sumindexb \in \{1,\ldots,\scenariosgeneratednumberof\}
\end{alignat}
For the ``distance'' function, we will use the 2-norm of the difference of the scenario parameters after scaling the scenario parameters according to the weights $\weights$ that we also used in \cref{sec:svd}:
\begin{equation}
	\distancefunc{\scenarioparstest}{\scenarioparsgenerated} = \normtwo{\weights\scenarioparstest - \weights\scenarioparsgenerated}.
\end{equation}



\subsection{Metric for testing scenario generation method}
\label{sec:metric scenario generation method}

The empirical Wasserstein metric $\wasserstein{\scenariosettest}{\scenariosetgenerated}$ is an approximation of the Wasserstein metric $\wassersteinp{1}{\densitysymbol}{\densityestsymbol}$.
As one might expect, using infinite number of scenario parameters, i.e., $\scenariostestnumberof\rightarrow\infty$ and $\scenariosgeneratednumberof\rightarrow\infty$, the empirical Wasserstein metric approaches the Wasserstein metric with probability 1. 
For a proof, see \autocite{sommerfeld2018inference}.
The problem, however, is that $\scenariostestnumberof$ and $\scenariosgeneratednumberof$ are not infinite. 
And whereas we can choose a fairly large number for $\scenariosgeneratednumberof$, as it is only limited by the available computing resources, to increase $\scenariostestnumberof$, more data are needed and this is generally expensive. Therefore, we propose a metric that is different from \cref{eq:empirical wasserstein}.

Our proposed metric is based on the following intuition: Suppose that $\densityestsymbol$ is indeed an approximation of $\densitysymbol$. 
Because $\scenarioset$ and $\scenariosettest$ are based on the same underlying \ac{pdf}, i.e., $\densitysymbol$, we expect $\wasserstein{\scenarioset}{\scenariosetgenerated}$ to be similar to $\wasserstein{\scenariosettest}{\scenariosetgenerated}$.
If, however, $\wasserstein{\scenarioset}{\scenariosetgenerated}$ is significantly smaller than $\wasserstein{\scenariosettest}{\scenariosetgenerated}$, it suggests that the generated scenarios are too much skewed towards the training data $\scenarioset$ and that, therefore, $\densityestsymbol$ is not an approximation of $\densitysymbol$.
To penalize any such skew, we introduce a penalty in case $\wasserstein{\scenariosettest}{\scenariosetgenerated}$ is larger than $\wasserstein{\scenarioset}{\scenariosetgenerated}$.
Thus, our proposed metric becomes:
\begin{equation}
	\label{eq:proposed metric}
	\proposedmetric{\scenariosetgenerated}{\scenariosettest}{\scenarioset}
	= \wasserstein{\scenariosettest}{\scenariosetgenerated} +
	\penaltyweight\left( \wasserstein{\scenariosettest}{\scenariosetgenerated} - \wasserstein{\scenarioset}{\scenariosetgenerated} \right).
\end{equation}
Here, $\penaltyweight$ is a parameter that controls the weight of the penalty. 
In \cref{sec:case study}, we will show what an appropriate value of $\penaltyweight$ could be.
The goal is to minimize the proposed metric of \cref{eq:proposed metric}.
In \cref{sec:case study}, we will demonstrate empirically that $\proposedmetric{\scenariosetgenerated}{\scenariosettest}{\scenarioset}$ of \cref{eq:proposed metric} better correlates with the Wasserstein metric of \cref{eq:wasserstein} than the empirical Wasserstein metric of \cref{eq:empirical wasserstein}.
