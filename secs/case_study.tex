\section{Case study}
\label{sec:case study}



\subsection{Comparison with Wang \& Stamatiadis' metric}
\label{sec:wang stamatiadis}

In this section, we will show that our method can be used to reproduce the metric of \textcite{wang2014evaluation}.
\textcite{wang2014evaluation} provide a metric that calculated the probability of a collision under certain assumptions. 
Because our method can be used to reproduce this metric, we argue that our method is a generalization of the metric of \textcite{wang2014evaluation}.
We will first explain the metric of \textcite{wang2014evaluation}. 
Next, in \cref{sec:wang stamatiadis replicate}, we will show how we estimate this metric using our method.
In \cref{sec:wang stamatiadis comparison}, we will illustrate the results of both.



\subsubsection{Metric of Wang \& Stamatiadis}
\label{sec:wang stamatiadis explanation}

The metric of \textcite{wang2014evaluation}, which we denote by $\wangstamatiadis$, calculates the probability of collision of the ``ego vehicle'' and the ``lead vehicle'', where the ego vehicle is following the lead vehicle.
The metric is based on the following assumptions:
\begin{itemize}
	\item The lead vehicle keeps a constant speed;
	\item The (driver of the) ego vehicle starts to react after its reaction time, denoted by $\timereact$;
	\item The reaction time $\timereact$ is distributed according to a log-normal distributions, such that the mean is \SI{0.92}{\second} and the standard deviation is \SI{0.28}{\second};
	\item When the ego vehicle reacts, it brakes with its \ac{madr}, denoted by $\accelerationmax$; and
	\item The \ac{madr} $\accelerationmax$ is distributed according to a truncated normal distribution with mean $\SI{9.7}{\meter\per\second\squared}$, standard deviation $\SI{1.3}{\meter\per\second\squared}$, lower bound $\lowerbound=\SI{4.2}{\meter\per\second\squared}$, and upper bound $\upperbound=\SI{12.7}{\meter\per\second\squared}$.
\end{itemize}
To calculate $\wangstamatiadis(\time)$ at a given time $\time$, the speed difference $\speeddifference{\time}$ and \ac{ttc} $\ttc{\time}$ are used.
If $\speeddifference{\time} \leq 0$, then the ego vehicle drives slower and there is no risk of collision according to the metric of \textcite{wang2014evaluation}, so $\wangstamatiadis=0$.
Note that the \ac{ttc} $\ttc{\time}$ is the ratio of the gap $\gap{\time}$ between the ego vehicle and the lead vehicle and the speed difference $\speeddifference{\time}$.
Given $\accelerationmax$, the driver of the ego vehicle needs to react before
\begin{equation}
	\ttc{\time} - \frac{\speeddifference{\time}}{2 \accelerationmax}
\end{equation}
in order to avoid a collision. 
Using the distributions of $\accelerationmax$ and $\timereact$, we can calculate the probability that this is the case, resulting in:
\begin{equation}
	\label{eq:ws}
	\wangstamatiadis(\time) = \begin{cases}
		0 & \text{if}\quad \speeddifference{\time} \leq 0 \\
		\int_{\lowerboundadapted}^{\upperbound}
		\probability{\timereact \leq \ttc{\time} - \frac{\speeddifference{\time}}{2 \accelerationmax} }
		\density{\accelerationmax} \ud \accelerationmax
		& \text{if}\quad \speeddifference{\time} > 0 \wedge \frac{\speeddifference{\time}}{2\ttc{\time}} < \upperbound \\
		1 & \text{otherwise}
	\end{cases},
\end{equation}
with $\lowerboundadapted=\max \left( \lowerbound, \frac{\speeddifference{\time}}{2\ttc{\time}}\right)$, $\probability{\timereact \leq \dummyvar}$ is the log-normal probability that the reaction time is lower than $\dummyvar$, and $\density{\accelerationmax}$ is the truncated normal probability density of $\accelerationmax$.



\subsubsection{Replicate Wang \& Stamatiadis' metric}
\label{sec:wang stamatiadis replicate}

Because the metric of \textcite{wang2014evaluation} uses the speed difference $\speeddifference{\time}$ and \ac{ttc} $\ttc{\time}$, these two variables are also used by our method to describe the current situation:
\begin{equation}
	\label{eq:situation current ws}
	\situationcurrent^T(\time) = \begin{bmatrix}
		\speeddifference{\time} & \ttc{\time}
	\end{bmatrix}.
\end{equation}
The lead vehicle is assumed to have a constant speed, so we can already describe the future situation of the lead vehicle using $\situationcurrent(\time)$ of \cref{eq:situation current ws}.
Therefore, $\situationfuturedim=0$ and there is no need to estimate $\densityestcond{\situationfuture}{\situationcurrent}$.
To estimate $\probabilitycond{\collision}{\situationcurrent}$, we use simulations. 
At the initial simulation time, the driver of the ego vehicle is not braking. 
After the reaction time $\timereact$, the driver starts braking with $\accelerationmax$.
The random parameters $\timereact$ and $\accelerationmax$ are similarly distributed as described in \cref{sec:wang stamatiadis explanation}.



\subsubsection{Comparison}
\label{sec:wang stamatiadis comparison}

\Cref{fig:ws comparison} shows the results of the comparison between the metric of \textcite{wang2014evaluation} and the metric derived using our proposed approach in \cref{sec:method}.
The black lines in \cref{fig:ws comparison} denote $\wangstamatiadis$ of \cref{eq:ws}.
These lines shows that for lower values of $\ttcsymbol$, $\wangstamatiadis$ increases.
Also, for increasing values of $\speeddifferencesymbol$ (solid, dashed, and dotted lines), the risk metric $\wangstamatiadis$ increases.

The gray lines in \cref{fig:ws comparison} denote $\probabilityestcond{\collision}{\situationcurrent,\situationfuture}$ of \cref{eq:estimate probability of collision}.
Because we have $\situationfuturedim=0$, we have $\probabilityestcond{\collision}{\situationcurrent} = \probabilityestcond{\collision}{\situationcurrent,\situationfuture}$.
\Cref{fig:ws comparison} illustrates that $\probabilityestcond{\collision}{\situationcurrent,\situationfuture}$ follows the same trend as $\wangstamatiadis$.
\Cref{fig:ws comparison} also illustrates the effect of the choice of the threshold $\simulationthreshold$.
In general, for a lower value of $\simulationthreshold$, the number of simulations $\numberofsimulations$ used in \cref{eq:kde simulation result} is higher. 
As a result, it can be expected that the estimation $\probabilityestcond{\collision}{\situationcurrent,\situationfuture}$ is closer to $\probabilitycond{\collision}{\situationcurrent,\situationfuture}$.
A comparison of the left plot in \cref{fig:ws comparison} ($\simulationthreshold=0.2$) with the right plot ($\simulationthreshold=0.02$) demonstrates this effect.

\setlength{\figurewidth}{.47\linewidth}
\setlength{\figureheight}{.7\figurewidth}
\begin{figure}
	\centering
	\input{figs/ws_comparison_coarse.tikz}
	\input{figs/ws_comparison_fine.tikz}
	\caption{Comparison of $\wangstamatiadis$ of \cref{eq:ws} (black lines) and $\probabilityestcond{\collision}{\situationcurrent}$ (gray lines) for a speed difference of $\speeddifferencesymbol=\SI{10}{\meter\per\second}$ (solid lines), $\speeddifferencesymbol=\SI{20}{\meter\per\second}$ (dashed lines), and $\speeddifferencesymbol=\SI{30}{\meter\per\second}$ (dotted lines).
		Here, $\probabilityestcond{\collision}{\situationcurrent}$ is based on the same underlying assumptions as $\wangstamatiadis$, see \cref{sec:wang stamatiadis explanation}.
		The influence of the parameter $\simulationthreshold$, which determines the number of simulations to estimate $\probabilitycond{\collision}{\situationcurrent}$, is illustrated by using $\simulationthreshold=0.2$ (left plot) and $\simulationthreshold=0.02$ (right plot).}
	\label{fig:ws comparison}
\end{figure}


