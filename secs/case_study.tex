\section{Case study}
\label{sec:case study}

In the first part of the case study, we illustrate that the \ac{ourmethod} method generalizes the \ac{ssm} proposed by \textcite{wang2014evaluation}.
In \cref{sec:ngsim metric}, we demonstrate how our the \ac{ourmethod} method can be used to create a new \ac{ssm} that calculates the risk of a collision in a longitudinal interaction between two vehicles.
The \ac{ssm} derived in \cref{sec:ngsim metric} is analyzed in \cref{sec:analyzing ngsim metric}.
The last part of the case study discusses and illustrates a method for benchmarking the \ac{ssm}.



\subsection{Comparison with Wang and Stamatiadis' measure}
\label{sec:wang stamatiadis}

%In this section, we show that our method can be used to reproduce the \ac{ssm} of \textcite{wang2014evaluation}.
\textcite{wang2014evaluation} provide \iac{ssm}, \cstartb which we denote by $\wangstamatiadis$, \cendb that calculates the probability of a collision under certain assumptions. 
Because our method can be used to reproduce this measure, we argue that our method is a generalization of $\wangstamatiadis$.
We first explain how $\wangstamatiadis$ is calculated. 
Next, \cref{sec:wang stamatiadis replicate} shows how to estimate this \ac{ssm} using our method.
In \cref{sec:wang stamatiadis comparison}, we illustrate the results of both.



\subsubsection{Measure of Wang and Stamatiadis}
\label{sec:wang stamatiadis explanation}

The \ac{ssm} $\wangstamatiadis$ calculates the probability of collision of the ego vehicle and the leading vehicle, where the ego vehicle is following the leading vehicle.
The \ac{ssm} is based on the following assumptions \autocite{wang2014evaluation}:
\begin{itemize}
	\item The leading vehicle keeps a constant speed;
	\item The (driver of the) ego vehicle starts to brake after its reaction time, denoted by $\timereact$;
	\item The reaction time $\timereact$ is distributed according to a log-normal distribution, such that the mean is \SI{0.92}{\second} and the standard deviation is \SI{0.28}{\second};
	\item When the ego vehicle reacts, it brakes with its \ac{madr}, denoted by $\accelerationmax$; and
	\item $\accelerationmax$ is distributed according to a truncated normal distribution with mean $\SI{9.7}{\meter\per\second\squared}$, standard deviation $\SI{1.3}{\meter\per\second\squared}$, lower bound $\lowerbound=\SI{4.2}{\meter\per\second\squared}$, and upper bound $\upperbound=\SI{12.7}{\meter\per\second\squared}$.
\end{itemize}
To calculate $\wangstamatiadis$ at a given time $\time$, the speed difference between the ego vehicle and the leading vehicle, $\speeddifference{\time}$, and the \ac{ttc}, $\ttc{\time}$, are used.
Note that $\ttc{\time}$ is the ratio of the gap, $\gap{\time}$, between the ego vehicle and the leading vehicle and $\speeddifference{\time}$.
If $\speeddifference{\time} \leq 0$, then the ego vehicle drives slower and there is no risk of collision according to \textcite{wang2014evaluation}, so $\wangstamatiadis(\time)=0$.
Given $\accelerationmax$, the driver of the ego vehicle needs to react within
\begin{equation}
	\timemaxreact(\time) = \ttc{\time} - \frac{\speeddifference{\time}}{2 \accelerationmax}
\end{equation}
in order to avoid a collision. 
Using the distributions of $\accelerationmax$ and $\timereact$, we can calculate the probability that this is the case, resulting in:
\begin{equation}
	\label{eq:ws}
	\wangstamatiadis(\time) = \begin{cases}
		0 & \text{if}\quad \speeddifference{\time} \leq 0 \\
		\int_{\lowerboundadapted}^{\upperbound}
		\int_{0}^{\timemaxreact(\time)}
		\density{\timereact} \density{\accelerationmax} \ud \timereact \ud \accelerationmax
		& \text{if}\quad \speeddifference{\time} > 0 \wedge \frac{\speeddifference{\time}}{2\ttc{\time}} < \upperbound \\
		1 & \text{otherwise}
	\end{cases},
\end{equation}
with $\lowerboundadapted=\max \left( \lowerbound, \frac{\speeddifference{\time}}{2\ttc{\time}}\right)$,
$\density{\timereact}$ is the log-normal probability density of $\timereact$ and $\density{\accelerationmax}$ is the truncated normal probability density of $\accelerationmax$.



\subsubsection{Replicating Wang and Stamatiadis' measure}
\label{sec:wang stamatiadis replicate}

Because $\wangstamatiadis$ is based on $\speeddifference{\time}$ and $\ttc{\time}$, these two variables are also used by the \ac{ourmethod} method to describe the current situation:
\begin{equation}
	\label{eq:situation current ws}
	\situationcurrent\transpose(\time) = \begin{bmatrix}
		\speeddifference{\time} & \ttc{\time}
	\end{bmatrix}.
\end{equation}
The leading vehicle is assumed to have a constant speed, so $\situationcurrent(\time)$ of \cref{eq:situation current ws} already describes the future situation of the leading vehicle.
Therefore, $\situationfuturedim=0$ and there is no need to estimate $\densitycond{\situationfuture}{\situationcurrent}$.
At the start of each simulation run, the driver of the ego vehicle is not braking. 
After the reaction time $\timereact$, the driver starts braking with $\accelerationmax$.
The random parameters $\timereact$ and $\accelerationmax$ are similarly distributed as described in \cref{sec:wang stamatiadis explanation}.
\cstartb For the comparison, we will use $\probabilityestcond{\collision}{\situationcurrent}$ of \cref{eq:estimate probability of collision} with $\simulationthreshold=0.2$ and $\simulationthreshold=0.02$, so no use is made of the \ac{nw} kernel estimator of \cref{eq:nadaraya watson}. \cendb



\subsubsection{Comparison}
\label{sec:wang stamatiadis comparison}

\Cref{fig:ws comparison} shows the results of the comparison between the measure of \textcite{wang2014evaluation} and the measure derived using the \ac{ourmethod} method described in \cref{sec:method}.
The black lines in \cref{fig:ws comparison} denote $\wangstamatiadis$ of \cref{eq:ws}.
These lines show that for lower values of $\ttcsymbol$, $\wangstamatiadis$ increases.
Also, for increasing values of $\speeddifferencesymbol$ (solid, dashed, and dotted lines), the risk measure $\wangstamatiadis$ increases.
\cstartb Both these observations match the intuition that a lower \ac{ttc} and a higher speed difference are less safe. \cendb

The gray lines in \cref{fig:ws comparison} denote $\probabilityestcond{\collision}{\situationcurrent}$ of \cref{eq:estimate probability of collision}.
\Cref{fig:ws comparison} illustrates that $\probabilityestcond{\collision}{\situationcurrent}$ follows the same trend as $\wangstamatiadis$.
\Cref{fig:ws comparison} also illustrates the effect of the choice of the threshold $\simulationthreshold$.
In general, for a lower value of $\simulationthreshold$, the number of simulations $\numberofsimulations$ used in \cref{eq:kde simulation result} is higher. 
As a result, it can be expected that the estimation $\probabilityestcond{\collision}{\situationcurrent}$ is closer to $\probabilitycond{\collision}{\situationcurrent}$ \cstartb (cf.\ \cref{eq:variance estimation})\cendb.
A comparison of \cref{fig:ws comparison coarse} ($\simulationthreshold=0.2$) and \cref{fig:ws comparison fine} ($\simulationthreshold=0.02$) demonstrates this effect.

\setlength{\figurewidth}{.47\linewidth}
\setlength{\figureheight}{.7\figurewidth}
\begin{figure}
	\centering
	\begin{subfigure}{.49\linewidth}
		\centering
		\input{figs/ws_comparison_coarse.tikz}
		\caption{$\simulationthreshold=0.2$.}
		\label{fig:ws comparison coarse}
	\end{subfigure}
	\begin{subfigure}{.49\linewidth}
		\centering
		\input{figs/ws_comparison_fine.tikz}
		\caption{$\simulationthreshold=0.02$.}
		\label{fig:ws comparison fine}
	\end{subfigure}
	\caption{Comparison of $\wangstamatiadis$ of \cref{eq:ws} (black lines) and $\probabilityestcond{\collision}{\situationcurrent}$ of \cref{eq:estimate probability of collision} (gray lines) for a speed difference of $\speeddifferencesymbol=\SI{10}{\meter\per\second}$ (solid lines), $\speeddifferencesymbol=\SI{20}{\meter\per\second}$ (dashed lines), and $\speeddifferencesymbol=\SI{30}{\meter\per\second}$ (dotted lines).
		Here, $\probabilityestcond{\collision}{\situationcurrent}$ is based on the same underlying assumptions as $\wangstamatiadis$, see \cref{sec:wang stamatiadis explanation}.
		The influence of the parameter $\simulationthreshold$, which determines the number of simulations to estimate $\probabilitycond{\collision}{\situationcurrent}$, is illustrated by using different values.}
	\label{fig:ws comparison}
\end{figure}



\subsection{Developing \iac{ssm} for longitudinal interactions}
\label{sec:ngsim metric}

To further illustrate the \ac{ourmethod} method, we apply it to derive \iac{ssm} that calculates the risk of a collision in a longitudinal interaction between two vehicles.
The \ac{ssm} is based on the \ac{ngsim} data set.
The \ac{ngsim} data set contains vehicle trajectories obtained from video footage of cameras that were located at several motorways in the US \autocite{kovvali2007video}. 
The derived \ac{ssm} estimates the risk of collision of the ego vehicle with its leading vehicle.
To describe the current situation at time $\time$, $\situationcurrentdim=4$ parameters are used:
\begin{itemize}
	\item The speed of the leading vehicle ($\speedlead{\time}$);
	\item The acceleration of the leading vehicle ($\accelerationlead{\time}$);
	\item The speed of the ego vehicle ($\speedego{\time}$); and
	\item The gap between the leading vehicle and the ego vehicle $\gap{\time}$.
\end{itemize}
Thus, we have:
\begin{equation}
	\situationcurrent\transpose(\time) = \begin{bmatrix}
		\speedlead{\time} & \accelerationlead{\time} & \speedego{\time} & \gap{\time}
	\end{bmatrix}.
\end{equation}

The speed of the leading vehicle at $\situationfuturehorizon=50$ instances, each $\situationfuturetimestep=\SI{0.1}{\second}$ apart, describes the future situation:
\begin{equation}
	\label{eq:example future situation}
	\situationfuture\transpose(\time) = \begin{bmatrix}
		\speedlead{\time+\situationfuturetimestep} & \cdots & \speedlead{\time+\situationfuturehorizon\situationfuturetimestep}
	\end{bmatrix}.
\end{equation}
It is assumed that $\situationfuture(\time)$ depends on $\speedlead{\time}$ and $\accelerationlead{\time}$. 
To model this \cstartb dependence \cendb with a single kernel density estimator would give us \iac{pdf} with $\situationfuturehorizon+2$ dimensions.
To reduce the dimensionality, we use \iac{svd} as described in \cref{sec:parameter reduction} with\footnote{Note that because we assume that $\situationfuture(\time)$ depends on 2 parameters of $\situationcurrent(\time)$, i.e., $\speedlead{\time}$ and $\accelerationlead{\time}$, we need to choose $\dimension$ such that $2 < \dimension < \situationfuturehorizon+2$.} $\dimension=4$.
In total, 18182 longitudinal interactions between two vehicles are analyzed.
For each second of an interaction, we extract a ``current situation'' $\situationcurrentinstance{\situationindex}$ and a corresponding ``future situation'' $\situationfutureinstance{\situationindex}$. 
This leads to $\situationnumberof=469453$ data points.
Based on Silverman's rule of thumb \autocite{silverman1986density}, we use a bandwidth matrix $\bandwidthmatrix=\bandwidth^2\identitymatrix{4}$ for the \ac{kde} with $\bandwidth\approx 0.186$ and $\identitymatrix{4}$ denoting the 4-by-4 identity matrix.

\cstartb To demonstrate the sampling from the estimated density of the reduced parameter vector subject to a linear constraint like \cref{eq:linear constraint}, \cendb the plots in \cref{fig:speed profiles} show 50 different future situations in the form of \cref{eq:example future situation}.
\Cref{fig:speed profiles accelerating} assumes a current situation with $\speedleadsymbol=\SI{15}{\meter\per\second}$ and $\accelerationleadsymbol=\SI{1}{\meter\per\second\squared}$ and \cref{fig:speed profiles decelerating} assumes a current situation with $\speedleadsymbol=\SI{15}{\meter\per\second}$ and $\accelerationleadsymbol=\SI{-1}{\meter\per\second\squared}$.
Note that the same \ac{pdf} is used to produce the lines in \cref{fig:speed profiles}; the only difference between \cref{fig:speed profiles accelerating} and \cref{fig:speed profiles decelerating} is a different linear constraint \cstartb (based on $\speedleadsymbol$ and $\accelerationleadsymbol$) \cendb on the generated samples.
In case a simulation run is longer than \SI{5}{\second}, the speed of the leading vehicle is assumed to remain constant after these \SI{5}{\second}.
\cstartb Note that a simulation run is rarely longer than \SI{5}{\second}, so this assumptions does not have a significant effect on the results. \cendb

\setlength{\figurewidth}{.49\linewidth}
\setlength{\figureheight}{.7\figurewidth}
\begin{figure}
	\centering
	\begin{subfigure}{.49\linewidth}
		\centering
		\input{figs/speed_profiles_a.tikz}
		\caption{Initial situation: $\speedleadsymbol=\SI{15}{\meter\per\second}$ and $\accelerationleadsymbol=\SI{1}{\meter\per\second\squared}$.}
		\label{fig:speed profiles accelerating}
	\end{subfigure}
	\begin{subfigure}{.49\linewidth}
		\centering
		\input{figs/speed_profiles_b.tikz}
		\caption{Initial situation: $\speedleadsymbol=\SI{15}{\meter\per\second}$ and $\accelerationleadsymbol=\SI{-1}{\meter\per\second\squared}$.}
		\label{fig:speed profiles decelerating}
	\end{subfigure}
	\caption{50 potential future situations samples from the \ac{kde} that is constructed using data from the \ac{ngsim} data set.}
	\label{fig:speed profiles}
\end{figure}

To estimate $\probabilitycond{\collision}{\situationcurrent}$ (\cref{sec:estimate collision}), we use the driver behavior model \ac{idmplus} \autocite{schakel2010effects} for modeling the ego vehicle response.
In addition to \ac{idmplus}, we assume that the driver has a reaction time that is similarly distributed as $\timereact$ in \cref{sec:wang stamatiadis explanation} and that the \ac{madr} is similarly distributed as $\accelerationmax$ in \cref{sec:wang stamatiadis explanation}.
\cstartb A simulation run ends if either the ego vehicle and the leading vehicle are colliding or if the gap between the ego vehicle and the leading vehicle is not decreasing. 
Depending on the reason for a simulation run to end, we consider the following result:
\begin{itemize}
	\item If the ego vehicle and the leading vehicle are colliding, we are interested in the ``severity'' of the collision. 
	This is expressed using the speed difference: $\speedlead{\timeend} - \speedego{\timeend}$, with $\timeend$ denotes the final time of the simulation.
	\item If there is no collision, we are interested in close the two vehicles came.
	Therefore, the minimum gap is used, which is $\gap{\timeend}$.
\end{itemize}
Thus, we have: \cendb
\begin{equation}
	\simulationresult = \begin{cases}
		\speedlead{\timeend} - \speedego{\timeend} & \text{if collision} \\
		\gap{\timeend} & \text{otherwise}
	\end{cases}.
\end{equation}
Clearly, $\simulationresult<0$ indicates a collision, so $\spacecollision=(-\infty, 0)$.
\cstarta The minimum number of simulations to estimate $\probabilitycond{\collision}{\situationcurrent}$ is set to 5. 
The number of simulations is further increases until the condition in \cref{eq:condition stop simulations} with $\simulationthreshold=0.1$ is met. \cenda

To calculate $\probabilitycond{\collision}{\situationcurrent}$ using \cref{eq:nadaraya watson}, we create a grid of points $\situationcurrentinstance{\simulationindex}$, $\simulationindex\in\{1,\ldots,\numberofdesignpoints\}$ using the method explained in \cref{sec:final metric calculation}.
For $\weightmatrix$, we use a diagonal matrix with on its diagonal: 0.25, 4, 0.25, and 0.25, \cstartb which is a trade-off between keeping many points such that the estimation in \cref{eq:nadaraya watson} is accurate while also keeping the total number of points for which $\probabilitycond{\collision}{\situationcurrent}$ is estimated manageable.
With this choice of $\weightmatrix$, we have $\numberofdesignpoints=10036$. \cendb
For the regression of \cref{eq:nadaraya watson}, we use $\bandwidthnw=\weightmatrix^{-1}$.



\subsection{Analyzing the \acs{ssm} for longitudinal interactions}
\label{sec:analyzing ngsim metric}

The heat maps in \cref{fig:heatmaps} show how the developed \ac{ssm} depends on the input variables $\speedleadsymbol$ and $\gapsymbol$. 
The other two parameters, $\speedegosymbol$ and $\accelerationleadsymbol$ are fixed for each heat map.
The heat maps shows that the estimated probability of collision is practically 0 if both $\speedleadsymbol$ and $\gapsymbol$ are large.
This seems reasonable, because in that case, the ego vehicle is at a safe distance from its leading vehicle while the approaching speed is small. 
\cstartb In addition, for a fixed $\speedegosymbol$, we see that the risk of collision increases as the difference in speed decreases, as is expected. \cendb
The same applies for a decreasing distance between the two vehicles.
For small values of $\speedleadsymbol$ and $\gapsymbol$, the estimated probability of collision is practically 1.
The left and center heat maps of \cref{fig:heatmaps} show that for a higher speed of the ego vehicle, the probability of collision is estimated to be higher.
Similarly, the right and center heat maps of \cref{fig:heatmaps} show that for a lower initial acceleration of the leading vehicle, the probability of collision is estimated to be higher.

\setlength{\figurewidth}{.35\linewidth}
\setlength{\figureheight}{0.8\figurewidth}
\begin{figure}
	\centering
	\input{figs/heatmaps.tikz}
	\caption{Heat maps of the \ac{ssm} described in \cref{sec:ngsim metric} as a function of the speed of the leading vehicle ($\speedleadsymbol$) and the gap between the ego vehicle and the leading vehicle ($\gapsymbol$).
		For each heat map, the other two input parameters are fixed at $\speedegosymbol=\SI{25}{\meter\per\second}$ (left) or $\speedegosymbol=\SI{20}{\meter\per\second}$ (center and right) and $\accelerationleadsymbol=\SI{0}{\meter\per\second\squared}$ (left and center) or $\accelerationleadsymbol=\SI{-1}{\meter\per\second\squared}$ (right).
		The estimated probability of collision ranges from 0 (white) to 1 (black).}
	\label{fig:heatmaps}
\end{figure}

In \cref{fig:scenarios}, the evaluations of the measure described in \cref{sec:ngsim metric} are shown for 3 different scenarios. 
Each of the 3 scenarios considers an ego vehicle and a leading vehicle driving in front of the ego vehicle.
Both vehicles are driving in the same direction and in the same lane. 
%The speeds of the ego vehicle (black solid line) and the leading vehicle (black dashed line) are shown in the left plots of \cref{fig:scenarios} alongside the distance between the two vehicles (gray dotted line, scale on the right of the plot).
%The right plots of \cref{fig:scenarios} show the evaluations of the \ac{ssm} explained in \cref{sec:ngsim metric} for each of the three scenarios (black line).
For comparison, the right plots include the evaluations of $\wangstamatiadis$ of \cref{eq:ws}.

\setlength{\figurewidth}{.45\linewidth}
\setlength{\figureheight}{0.6\figurewidth}
\begin{figure}
	\centering
	\input{figs/case_safe_scenario.tikz}
	\input{figs/case_safe_metric.tikz}\\
	\input{figs/case_risky_scenario.tikz}
	\input{figs/case_risky_metric.tikz}\\
	\input{figs/case_collision_scenario.tikz}
	\input{figs/case_collision_metric.tikz}
	\caption{Demonstration of \acp{ssm} for 3 hypothetical scenarios. 
		The left plots show the speeds of the ego vehicle (solid black line) and leading vehicle (dashed black line) and the distance between the ego vehicle and the leading vehicle (dotted gray line, scale on the right of the plot).
		The right plots show the estimated probability of collision corresponding to the 3 scenarios according to the \ac{ssm} explained in \cref{sec:ngsim metric} (black lines) and the \ac{ssm} of \textcite{wang2014evaluation} explained in \cref{sec:wang stamatiadis explanation} (gray lines).}
	\label{fig:scenarios}		
\end{figure}

The first scenario in \cref{fig:scenarios} (top row) shows a scenario in which the leading vehicle initially drives with a speed of \SI{20}{\meter\per\second}.
The leading vehicle starts to decelerate after \SI{3}{\second} toward a speed of \SI{10}{\meter\per\second} with an average deceleration of \SI{3}{\meter\per\second\squared}.
The ego vehicle initially drives with a speed of \SI{24}{\meter\per\second} at a distance of \SI{40}{\meter} from the leading vehicle.
The ego vehicle starts decelerating after \SI{2}{\second} toward a speed of \SI{8}{\meter\per\second} within \SI{4}{\second}.
It takes \SI{4}{\second} more to reach the speed of the leading vehicle.
Because the ego vehicle always maintains a relatively large distance toward the leading vehicle, both \acp{ssm} do not qualify this scenario as risky, considering the estimated probability of collisions that stays below 0.1.

The second scenario in \cref{fig:scenarios} (center row) differs from the first scenario in that the ego vehicle starts to decelerate \SI{2}{\second} later.
As a result, the ego vehicle approaches the leading vehicle up to a distance of \SI{5.4}{\meter}.
According to $\probabilityestcond{\collision}{\situationcurrent}$ from \cref{sec:ngsim metric} (black line in the right plot of \cref{fig:scenarios}), the probability of collision reaches almost 1, indicating that around that time, the risk of a collision is high.
The local minimum of $\probabilityestcond{\collision}{\situationcurrent}$ at around \SI{6}{\second} illustrates the effect of the numerical approximation of $\probabilitycond{\collision}{\situationcurrent}$.
Because we have used $\simulationthreshold=0.1>0$, the resulting estimation may have an error. 
When lowering the threshold $\simulationthreshold$, the resulting $\probabilityestcond{\collision}{\situationcurrent}$ in the center right plot in \cref{fig:scenarios} will be smoother. 
This goes, however, at the cost of having to do more simulations \footnote{Alternatively, the bandwidth matrix $\bandwidthnw$ may be increased. 
	On the one hand, this will lower the variance of the error, but, on the other hand, it will increase the bias of the result.
	We refer the interested reader to \autocite{chen2017tutorial} for more details on the effect of $\bandwidthnw$.}.

The third scenario in \cref{fig:scenarios} (bottom row) differs from the second scenario in that the initial distance between the ego vehicle and the leading vehicle is \SI{31.5}{\meter} instead of \SI{40}{\meter}. 
As a result, the ego vehicle collides with the leading vehicle after \SI{6}{\second}.
As expected, the \acp{ssm} in \cref{fig:scenarios} indicate a collision probability of 1.
The difference between $\probabilityestcond{\collision}{\situationcurrent}$ and $\wangstamatiadis$ is that $\probabilityestcond{\collision}{\situationcurrent}$ increases earlier. 
\cstartb Note that $\probabilityestcond{\collision}{\situationcurrent}$ raising sooner than $\wangstamatiadis$ does not necessarily mean that it is better, because there is no objective truth. 
Hence, in the next section, we will present a qualitative approach to benchmark \iac{ssm}. \cendb



\subsection{Benchmarking an \acs{ssm} with expected risk tendencies}
\label{sec:tendencies}

In this section, we demonstrate an approach for benchmarking \iac{ssm} that is based on the so-called \emph{expected risk tendencies} of \textcite{mullakkal2017comparative}, who argue that the risk increases if the approaching speed of the ego vehicle toward the leading vehicle increases.
Also, the risk increases with a higher ego vehicle speed \autocite{aarts2006driving} or a higher driver reaction time \autocite{klauer2006impact}.
On the other hand, the risk decreases with a higher road friction \autocite{wallman2001friction} or a larger intervehicle spacing \autocite{mullakkal2017comparative}.

To check whether the developed \ac{ssm} follows these 5 expected risk tendencies\footnote{In \autocite{mullakkal2017comparative}, a sixth expected risk tendency is mentioned based on \autocite{evans1994driver}, namely the vehicle mass. 
Our interpretation of \autocite{evans1994driver}, however, is that the ratio of masses of two colliding vehicles influences the safety risk and that one cannot argue that a higher mass of the ego vehicle necessarily increases the safety risk. 
Therefore, we exclude the ego vehicle mass from our analysis.}, we evaluate the partial derivatives of the measure of \cref{eq:nadaraya watson}.
The intuition is as follows: If the expected risk tendency for an input X (e.g., the ego vehicle speed) is that the risk increases as X increases, then we expect the partial derivative of our \ac{ssm} with respect to X to be positive.
Furthermore, if we evaluate the partial derivative at many points, we expect that at least the majority of these evaluated partial derivatives is positive.
Analogously, if we expect that the risk measure decreases with increasing X, then we expect that at least the majority of the evaluated partial derivatives is negative.

To illustrate the approach for benchmarking \iac{ssm}, we use the \ac{ssm} of \cref{sec:ngsim metric} with a few adaptations.
Because we have not described an expected tendency regarding $\accelerationleadsymbol$, we simply use $\accelerationleadsymbol=0$.
\cstarta Also, because the expected risk tendency for the relative speed is defined, we use the relative speed, i.e., $\speeddifferencesymbol=\speedegosymbol-\speedleadsymbol$, instead of $\speedleadsymbol$. 
For the same reason, \cenda instead of assuming a random reaction time $\timereact$ and \ac{madr} $\accelerationmax$, these are now considered as input to our measure. 
% Finally, instead of using the log of the gap between the ego vehicle and the leading vehicle, we use the gap as a direct input.
Thus, we have:
\begin{equation}
	\label{eq:input partial derivatives}
	\situationcurrent\transpose = \begin{bmatrix}
		\speedegosymbol-\speedleadsymbol & \speedegosymbol & \timereact & \gapsymbol & \accelerationmax
	\end{bmatrix}.
\end{equation}

We compute $\probabilityestcond{\collision}{\situationcurrent}$ using \cref{eq:nadaraya watson} where the points $\situationcurrentinstance{\situationindexdesign}$, $\situationindexdesign\in\{1,\ldots,\numberofdesignpoints\}$ are taken from a grid.
A threshold $\simulationthreshold=0.02$ is used.
For each input variable, 10 different values at equal distance are used, resulting in $\numberofdesignpoints=10^5$.
Here, $\speedegosymbol-\speedleadsymbol$ ranges from \SI{0}{\meter\per\second} to \SI{20}{\meter\per\second}, $\speedegosymbol$ ranges from \SI{10}{\meter\per\second} to \SI{30}{\meter\per\second}, $\timereact$ ranges from \SI{0.5}{\second} to \SI{1.5}{\second}, $\gapsymbol$ ranges from \SI{5}{\meter} to \SI{30}{\meter}, and $\accelerationmax$ ranges from \SI{4}{\meter\per\second\squared} to \SI{10}{\meter\per\second\squared}.
For the bandwidth matrix $\bandwidthnw$, we use a diagonal matrix with the $(i,i)$-th entry corresponding to the squared reciprocal of the difference between two consecutive values of the $i$-th entry of $\situationcurrent$.
For example, the first value is $1/(\SI{20}{\meter\per\second}/(10-1))^2 \approx \SI{0.20}{\second\squared\per\meter\squared}$. 
The other values on the diagonal are: \SI{0.20}{\second\squared\per\meter\squared}, \SI{81}{\per\second\squared}, \SI{0.13}{\per\meter\squared}, and \SI{2.25}{\second\tothe{4}\per\meter\squared}.
For each input variable listed in \cref{eq:input partial derivatives}, we evaluate the partial derivative of \cref{eq:nadaraya watson} at each $\situationcurrentinstance{\situationindexdesign}$, $\situationindexdesign\in\{1,\ldots,\numberofdesignpoints\}$.

\Cref{tab:tendencies} shows the result of the benchmarking. 
It shows that the \ac{ssm} follows the expected risk tendencies mostly. 
E.g., in more than \SI{99}{\%} of the cases, the partial derivative of the relative speed ($\speedegosymbol-\speedleadsymbol$) is positive.
For the remaining \SI{1}{\%}, the partial derivative is negative, albeit only slightly. 
One explanation is that this remaining \SI{1}{\percent} is caused by the inaccuracies introduced by the numerical approximation of \cref{eq:estimate probability of collision}.

\begin{table}
	\centering
	\caption{Percentiles of the partial derivatives of the \ac{ssm} and the corresponding expected risk tendencies.}
	\label{tab:tendencies}
	\begin{tabular}{lrrrrr}
		\toprule
		& $\speedegosymbol-\speedleadsymbol$ & $\speedegosymbol$ & $\timereact$ & $\gapsymbol$ & $\accelerationmax$ \\
		\otoprule
		Expected tendency & Increase & Increase & Increase & Decrease & Decrease \\
		Maximum         &  0.1629 &  0.1555 &  1.3136 &  0.0010 &  0.0037 \\
		99th percentile &  0.1585 &  0.1162 &  0.8968 &  0.0002 &  0.0002 \\
		95th percentile &  0.1495 &  0.0524 &  0.6765 &  0.0000 & -0.0000 \\
		90th percentile &  0.1346 &  0.0151 &  0.5351 & -0.0000 & -0.0000 \\
		75th percentile &  0.0746 &  0.0012 &  0.2917 & -0.0002 & -0.0003 \\
		50th percentile &  0.0114 &  0.0001 &  0.0605 & -0.0070 & -0.0054 \\
		25th percentile &  0.0004 &  0.0000 &  0.0022 & -0.0320 & -0.0290 \\
		10th percentile &  0.0000 & -0.0000 &  0.0000 & -0.0545 & -0.0654 \\
		 5th percentile &  0.0000 & -0.0002 &  0.0000 & -0.0645 & -0.0880 \\
		 1st percentile &  0.0000 & -0.0007 & -0.0020 & -0.0781 & -0.1337 \\
		Minimum         & -0.0035 & -0.0030 & -0.0180 & -0.1076 & -0.2030 \\
		\bottomrule
	\end{tabular}
\end{table}

