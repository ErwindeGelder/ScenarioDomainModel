\section{Method for risk quantification}
\label{sec:method}

Our method for quantifying the risk for \iac{ads} consists of 5 steps:
\begin{itemize}
	\item Identify the scenarios that are part of the so-called \ac{odd} of the \ac{ads}.
	\item Determine the exposure of these scenarios, i.e., the expected number of occurrences.
	\item Simulate the response of the \ac{ads} in these scenarios.
	\item Calculate the expected number of harmful events.
	\item Calculate the severity, i.e., the expected injury rate.
\end{itemize}
These steps are schematically shown in \cref{fig:method}. 
In \cref{tab:definitions}, we present the definitions of the terms that are used in our proposed method.
In the following subsections, these 5 steps are further described.

\begin{figure*}
	\centering
	\input{figures/method.tikz}
	\caption{Schematic overview of the risk quantification method presented in this article. 
		Each of the 5 steps is further explained in \cref{sec:scenario identification,sec:exposure,sec:simulation,sec:harmful,sec:severity}, respectively.}
	\label{fig:method}
\end{figure*}

\newcolumntype{T}{>{\hsize=0.3\hsize}X}
\newcolumntype{D}{>{\hsize=1.7\hsize}X}
\begin{table}
	\caption{The terms and definitions.}
	\label{tab:definitions}
	\begin{tabularx}{\linewidth}{TD}
		\toprule
		Term & Definitions \\ \otoprule
		Risk & Combination of the probability of occurrence of harm and the severity of that harm \autocite{ISO26262} \\
		ODD & Operating conditions under which a given driving automation system or feature thereof is specifically designed to function, including, but not limited to, environmental, geographical, and time-of-day restrictions, and/or the requisite presence or absence of certain traffic or roadway characteristics \autocite{sae2021j3016} \\
		Scenario & Quantitative description of the relevant characteristics and activities and/or goals of the ego vehicle(s), the static environment, the dynamic environment, and all events that are relevant to the ego vehicle(s) within the time interval between the first and the last relevant event \autocite{degelder2021ontology} \\
		Scenario category & Qualitative description of the relevant characteristics and activities and/or goals of the ego vehicle(s), the static environment, and the dynamic environment \autocite{degelder2021ontology} \\
		Triggering condition & Specific conditions of a scenario that [may] serve as an initiator for a subsequent system reaction leading to hazardous behavior \autocite{ISO21448} \\
		\bottomrule
	\end{tabularx}
\end{table}



\subsection{Identification of scenarios}
\label{sec:scenario identification}

% ODD needed
An \ac{ads} is designed to operate within its \ac{odd}.
Therefore, the \ac{odd} is used to limit the risk analysis \autocite{gyllenhammar2020towards}.
So to quantify the risk of \iac{ads} in driving scenarios, we need to know the \ac{odd} of the \ac{ads}.
Once deployed, the \ac{ads} needs to deal with many scenarios and the \ac{odd} in which the \ac{ads} is operating determines the variety of these scenarios.
It is our goal to provide a method for determining the risk for the \ac{ads} in these scenarios.

% Distinguish between scenarios and scenario categories
Considering the wide variety of scenarios, we propose to distinguish between quantitative scenarios and qualitative scenarios, where scenario categories refer to the latter.
It is assumed that all possible scenarios within a given \ac{odd} can be categorized into one or more scenario categories. 
This assumption does not limit the applicability of this article, though it might require many scenario categories to describe all these scenarios.
In the remainder of this section, we will propose a method to calculate the risk for \iac{ads} in all scenarios that are categorized by the same scenario category.
This scenario category is denoted by $\scenariocategory$.
For example, the scenario category ``cut-in'' comprises all possible cut-in scenarios in the \ac{odd} of the \ac{ads}.
See \autocite{degelder2019scenariocategories} for more examples of scenario categories.

% How to obtain the scenario categories
%The selection of the scenario categories can be either knowledge based or data driven \autocite{riedmaier2020survey}.

% Triggering condition
\begin{remark}
	As part of the scenarios, some factors may cause hazardous behavior. 
	These factors are called ``triggering conditions'', because they may trigger some specific behavior \autocite{ISO21448}.
	Typically, triggering conditions may happen rarely, so we may not know the impact on safety. 
	In our case, one or more triggering conditions could be part of a scenario category.
	Examples of triggering conditions are heavy rain, low road friction, poor lighting, or dirty sensor(s). 
	For more examples, see \autocite{ISO21448}.
\end{remark}



\subsection{Probability of exposure}
\label{sec:exposure}

To determine the exposure, we estimate the expected number of encounters of a scenario comprised by given scenario category $\scenariocategory$.
Let $\numberofencounters$ denote the number of encounters, so we can express the exposure as $\expectation{\numberofencounters|\scenariocategory}$, i.e., the expected number of encounters of a scenario from the given scenario category $\scenariocategory$.
The exposure could be either expressed in terms of number of encounters per unit of distance or number of encounters per unit of time.
To calculate the exposure, we use the following equation:
\begin{equation}
	\label{eq:exposure}
	\expectation{\numberofencounters|\scenariocategory}
	 = \sum_{\numberofencounters=1}^{\infty} \numberofencounters \probability{\numberofencounters|\scenariocategory},
\end{equation}
where $\probability{\numberofencounters|\scenariocategory}$ denotes the probability of encountering $\numberofencounters$ scenarios from scenario category $\scenariocategory$.

We propose to determine $\probability{\numberofencounters|\scenariocategory}$, $\numberofencounters=1,2,\ldots$, based on data, because the data provide an objective and quantitative way to estimate $\probability{\numberofencounters|\scenariocategory}$, $\numberofencounters=1,2,\ldots$, assuming that the data are collected with the same conditions as specified by the \ac{odd} of the \ac{ads}.
The probability can be estimated by counting the number of occurrences of the scenarios in the data.
The method to find the scenarios comprised by $\scenariocategory$ is explained in \autocite{degelder2020scenariomining}.
In short, a two-step approach is used.
First, tags are used to annotate the data.
Tags describe, e.g., the behavior of the ego vehicle and any other vehicle.
Second, by searching for a combination of tags that describes the scenario category $\scenariocategory$, the scenarios are extracted from the data.

\begin{remark}
	It is not uncommon to assume that $\probability{\numberofencounters|\scenariocategory}$ follows the Poisson distribution \autocite{nicholson1993accidents, wachenfeld2017new, gyllenhammar2020towards}, i.e., 
	\begin{equation}
		\label{eq:poisson}
		\probability{\numberofencounters|\scenariocategory} = 
		\frac{\poissonparameter^{\numberofencounters}}{\numberofencounters!} \e{-\poissonparameter}.
	\end{equation}
	Here, $\poissonparameter>0$ is a parameter that determines the rate at which a scenario from $\scenariocategory$ occurs.
	Assuming \cref{eq:poisson}, \cref{eq:exposure} simplifies to $\expectation{\numberofencounters|\scenariocategory}=\poissonparameter$.
	The Poisson distribution is only appropriate if we can assume the following:
	\begin{itemize}
		\item The occurrence of a scenario from $\scenariocategory$ does not affect the probability that a second scenario from $\scenariocategory$ occurs.
		\item The rate at which a scenario from $\scenariocategory$ occurs is constant.
		\item Two scenarios from $\scenariocategory$ cannot occur at exactly the same time.
	\end{itemize}
\end{remark}



\subsection{Simulation of scenarios}
\label{sec:simulation}



\subsection{Probability of harmful event}
\label{sec:harmful}



\subsection{Calculation of severity}
\label{sec:severity}
