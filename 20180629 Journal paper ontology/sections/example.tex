\section{Example: pedestrian crossing}
\label{sec:example}

To illustrate the use of the \cstartb \ac{oof}\cendb, we describe a scenario using objects of the \cstartb classes \cendb presented in \cref{sec:oo framework}. The scenario is schematically shown in \cref{fig:scenario overview}. The ego vehicle is driving on the right lane of a two-lane road and a pedestrian is walking on a footway that intersects the road the ego vehicle is driving on. Both the ego vehicle and the pedestrian are initially approaching the pedestrian crossing. The ego vehicle brakes and comes to a full stop in front of the pedestrian crossing. While the ego vehicle is stationary, the pedestrian crosses the road using the pedestrian crossing. When the pedestrian has passed the ego vehicle, the ego vehicle accelerates. The code of this example is publicly available\footnote{See \url{https://github.com/ErwindeGelder/ScenarioDomainModel}. The repository also contains other examples.}.

\setlength{\figurewidth}{0.6\linewidth}
\begin{figure}[t]
	\centering
	\input{figures/example_overview.tikz}
	\caption{Schematic overview of a scenario where both the ego vehicle and a pedestrian are approaching a non-signalized pedestrian crossing. The pedestrian has priority. 
	%The origin of the coordinate system is represented by $O$. The easting and northing coordinates are denoted by $\east$ and $\north$, respectively. The angle is denoted by $\head$.
	}
	\label{fig:scenario overview}
\end{figure}

%\begin{figure}
%	\centering
%	\scentags{>Ego; Braking; Stationary; Accelerating|
%		>Actor; Pedestrian; Initial state, Direction/Crossing, Long.\ position/In front of ego; Walking straight|
%	Road layout, non-signalized zebra crossing}
%\end{figure}

\cstartc This particular scenario can be used to formulate a test case for the assessment of \iac{av}. For example, when assessing a pedestrian automatic emergency braking system \autocite{seiniger2015test}, we are interested in the behavior of the system in case the driver or automation system of the ego vehicle does not brake. \cendc

We first describe the scenario qualitatively using our proposed \cstartb framework\cendb. Next, the scenario is described quantitatively in \cref{sec:example quantitative}. 
In \cref{sec:example test case}, we show \cstarte which objects are reused and which objects are different if we consider an actual test case with a crossing pedestrian. \cende



\subsection{Qualitative description of the pedestrian crossing}
\label{sec:example qualitative}

To describe the scenario according to the presented domain model, objects are instantiated from the classes presented in \cref{fig:class overview,fig:class relations}. \Cref{fig:example qualitative} shows the objects for describing the scenario qualitatively. There are two \textit{actor categories}: one for the ego vehicle and one for the pedestrian. Four different \textit{activity categories} are defined: \textit{braking}, \textit{stationary}, \textit{accelerating}, and \emph{walking straight}. 
\cstarte The \textit{braking}, \textit{stationary}, and \textit{accelerating activity categories} contain the state variable $\egospeed$, i.e., the speed of the ego vehicle, and use the \textit{Sinusoidal} model of \cref{eq:sinusoidala,eq:sinusoidalb}, the \textit{Constant} model of \cref{eq:constant}, and the \textit{Linear} model of \cref{eq:linear}, respectively. 
The \textit{activity category walking straight} has the position of the pedestrian ($\pednorth$) as its state variable and uses the \textit{Linear} model of \cref{eq:linear}. \cende 

\begin{figure*}[t]
	\centering
	\input{figures/example_qualitative.tikz}
	\caption{The objects that are used to qualitatively describe the scenario that is schematically shown in \cref{fig:scenario overview}. The first line of each block shows the name (before the double colon) and the class from which the object is instantiated. The following lines show the attributes of the object with the name and value of the attribute before and after the colon, respectively. For the sake of brevity, the unique ID of each object is omitted.}
	\label{fig:example qualitative}
\end{figure*}


The two \textit{actor categories}, the four \textit{activity categories}, and the \cstartc\textit{physical element category} \cendc\cstartd that represents the crosswalk\cendd, are used by the \textit{scenario category}. The \textit{scenario category} has four acts. The first three acts assign the first three \textit{activity categories} to the ego vehicle. The last act assigns the \textit{activity category} \emph{walking straight} to the pedestrian. 



\subsection{Quantitative description of the pedestrian crossing}
\label{sec:example quantitative}

The objects to describe the scenario quantitatively are shown in \cref{fig:example quantitative}. The two \textit{actors} refer to the quantitative counterparts of the \textit{actor categories} in \cref{fig:example qualitative}. Initial state vectors are listed for each \textit{actor} using the coordinate frame that is shown in \cref{fig:scenario overview}. 
%It is not necessary to describe the initial northing position of the pedestrian, because it will be described by an activity. For a similar reason, the initial speed of both actors is not included. 
Since we are describing a real-world scenario, there is no need to define \cstarte goals or intents \cende for the actors.


\begin{figure*}[t]
	\centering
	\input{figures/example_quantitative.tikz}
	\caption{The objects that are used to quantitatively describe the scenario that is schematically shown in \cref{fig:scenario overview}. For the sake of brevity, the tags and the unique ID of each object are omitted.}
	\label{fig:example quantitative}
\end{figure*}

\cstartb There are four \textit{events} defined. These \textit{events} mark the time instants that define the start and the end of the \textit{activities}. For simplicity, it is assumed that the start of the scenario occurs at \SI{0}{\second}. \cendb

There are four \textit{activities} defined and each of these \textit{activities} refers to its qualitative counterpart.
The \textit{activities} contain the values of the parameters as well as \cstartb events that mark the start and the end of the \textit{activities}\cendb. 
As described by the first \textit{activity} (\emph{ego braking}), the ego vehicle starts with a speed of \SI{8}{\meter\per\second} and brakes in \SI{4}{\second} to come to a full stop. By integrating the sinusoidal function of \cref{eq:sinusoidala} twice, it can be shown that the ego vehicle stops at \SI{4}{\meter} from the center of the pedestrian crossing. 
After waiting for \SI{3}{\second} \cstarte as described by \cende the second \textit{activity} (\emph{ego stationary}), the ego vehicle accelerates with \SI{1.5}{\meter\per\second\squared} towards a speed of \SI{7.5}{\meter\per\second} \cstarte as described by \cende the third \textit{activity} (\emph{ego accelerating}). 
The fourth \textit{activity} describes the position \cstarte and speed \cende of the pedestrian.

The \textit{pedestrian crossing} describes \cstartd the entire static environment, including \cendd the main road the ego vehicle is driving on and the footway the pedestrian is walking on. The example in \cref{fig:example quantitative} shows some properties of the road layout to illustrate how the static environment can be described. Note that, in practice, the quantitative description of the static environment may contain many more facets than the ones mentioned in \cref{fig:example quantitative}. As mentioned in \cref{sec:scenario}, it is possible to refer to another source that contains a description of (part of) the static environment, see, e.g., \autocite{dupuis2010opendrive}. 

The \textit{scenario} has the previously defined \cstartc\textit{physical element}\cendc, \textit{actors}, and \textit{activities} as attributes. The acts are used to assign the first three \textit{activities} to the ego vehicle and the last \textit{activity} to the pedestrian. 
The \textit{scenario} also has \cstartb \textit{events} marking the start and the end of the \textit{scenario}\cendb.
A different \textit{scenario} can be defined by, e.g., changing the parameter values. This illustrates that the \textit{scenario category} in \cref{fig:example qualitative} comprises multiple \textit{scenarios}, including the \textit{scenarios} that only differ from the \textit{scenario} in \cref{fig:example quantitative} because of different parameter values.



\subsection{Test case with pedestrian crossing}
\label{sec:example test case}
% Differences:
% - No activities of ego vehicle
% - Initial distance further away
% - Initial speed defined (one might argue that it should not be 0)
% - Note: no additional goals like "stay in lane" and "do not collide with pedestrian". This should always be the goal, not only in this case.
% - Pedestrian walking is now a triggered activity (see also event)
% - Scenario does not describe activities of ego vehicle anymore


\begin{figure*}[t]
	\centering
	\input{figures/example_test_case.tikz}
	\caption{The objects that, together with the objects \emph{Ego qualitative}, \emph{Pedestrian qualitative}, \emph{Walking straight}, and \emph{Pedestrian crossing qualitative} from \cref{fig:example qualitative} and \emph{Start scenario}, \emph{Pedestrian}, and \emph{Pedestrian crossing} from \cref{fig:example quantitative}, describe a test case that is schematically shown in \cref{fig:scenario overview}. For the sake of brevity, the tags and the unique ID of each object are omitted.}
	\label{fig:example test case}
\end{figure*}


In this example, we consider a test case based on the previously illustrated real-world scenario, see \cref{fig:scenario overview}. 
\cstarte To describe the test case, we reuse the two \textit{actor categories} from \cref{fig:example qualitative} (\emph{ego qualitative} and \emph{pedestrian qualitative}) and the \textit{actor} describing the pedestrian from \cref{fig:example quantitative} (\emph{pedestrian crossing}). \cende
\Cref{fig:example test case} shows the \cstarte other \cende objects that are used to describe this test case. 


%\Cref{fig:example test case} shows the objects that change when describing a test case instead of the scenario that is described in \cref{fig:example qualitative,fig:example quantitative}. There are five objects that are different:

The \textit{scenario category} only differs from the \textit{scenario category} shown in \cref{fig:example qualitative} in that it does not contain the \textit{activity categories} that describe the activity of the ego vehicle.

Two attributes of the quantitative description of the ego vehicle are different. First, the initial state vector also includes the speed, denoted by $\egospeed$, at the start of the scenario and the initial position is further away from the pedestrian crossing, such that the ego vehicle's driver or automation system has more time to perceive the pedestrian. 
%Note that we choose for a start at rest as this is most practical when performing a test in real life. Therefore, the ego vehicle needs to accelerate to approach the pedestrian crossing, which is why the initial distance is larger (\SI{60}{\meter} instead of \SI{20}{\meter}). 
Secondly, because there are no activities defined for the ego vehicle, the desired state vector is defined. The goal is to reach the point \SI{80}{\meter} in front of the ego vehicle while driving with a speed of $\egospeed=\SI{8}{\meter\per\second}$.

The \textit{event} that marks the start of the walking activity of the pedestrian is triggered when the ego vehicle is \SI{2.5}{\second} away from the center of the footway, assuming that the speed of the ego vehicle is constant. In case the ego vehicle drives with a speed of $\egospeed=\SI{8}{\meter\per\second}$, this is at a distance of \SI{20}{\meter}, similar to the scenario described in \cref{fig:example quantitative}.

% For the test case, the pedestrian starts walking when the corresponding event is triggered. Hence, this \textit{activity} is a \textit{triggered activity} instead of a \textit{set activity}.

As with the \textit{scenario category}, the \textit{scenario} does not contain \textit{activities} of the ego vehicle. 
\cstartb Furthermore, the end event of the scenario is defined differently: now the scenario ends if the ego vehicle either reaches its destination ($\egoeast \geq \SI{20}{\meter}$), collides with the pedestrian, deviates too much from its path ($\egonorth \leq \SI{-2}{\meter}$ or $\egonorth \geq \SI{1}{\meter}$), or takes too long to reach the destination ($\time > \SI{100}{\second}$). \cendb

\cstartd This example illustrates the benefits of an object-oriented approach for defining a scenario. The modularity makes it easy to understand the changes from the scenario in \cref{fig:example quantitative} to the test case in \cref{fig:example test case}. Several objects, such as the \textit{events}, are used more than once, which illustrates the reusability. Furthermore, each object listed in \cref{fig:example qualitative,fig:example quantitative,fig:example test case} is directly translatable to an object in an object-oriented programming language. \cendd

