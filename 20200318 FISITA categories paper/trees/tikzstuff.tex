\definecolor{lightgray}{RGB}{222,222,231}
\newlength{\hwidth}\setlength{\hwidth}{4.22em}
\tikzstyle{tag}=[text height=.8em, text depth=.1em, font=\small\sffamily, rounded corners=0.2em, fill=lightgray, node distance=8em, text width=2*\hwidth-2em, align=center]
\tikzstyle{tag wide}=[tag, text width=12em]
\tikzstyle{tag next to wide}=[tag, node distance=11.5em]
\tikzstyle{tagemphasize}=[]
\tikzstyle{tagarrow}=[->, line width=0.75mm, color=lightgray]
\ExplSyntaxOn
\newcounter{tagbcounter}
\newcounter{tagccounter}
\newcommand{\showtag}[3]{
	\StrLeft{#3}{1}[\firstchar]
	\IfStrEq{\firstchar}{*}{
		\node[#1, tagemphasize](#2){\StrGobbleLeft{#3}{1}};
	}{
		\node[#1](#2){#3};
	}
}
\newcommand{\taga}[1]{
	\showtag{tag~wide}{taga}{#1};
	\node[coordinate, below~of=taga, node~distance=1.5em](helper){};
}
\newcommand{\tagb}[3]{
	\showtag{tag, below~of=taga, node~distance=3.5em, xshift=#3}{tagb#2}{#1};
	\draw[tagarrow] (taga) -- (helper) -| (tagb#2);
	\node[coordinate, xshift=.5em](tagb#2 helper) at (tagb#2.south~west) {};
}
\newcommand{\tagc}[4]{
	\showtag{tag, below~of=tagb#4, node~distance=#3em, xshift=1.5em}{tagc#2}{#1};
	\draw[tagarrow] (tagb#4 helper) |- (tagc#2);
}
\NewDocumentCommand{\tree}{O{} m m}{%
	\begin{tikzpicture}
	\taga{#2}
	\setcounter{tagbcounter}{0}
	\seq_set_split:Nnn \arg { ; } { #3 }
	\seq_map_inline:Nn \arg {
		\seq_set_split:Nnn \argb {,} {##1}
		\seq_pop_left:NN \argb \argl
		\tagb{\argl}{\arabic{tagbcounter}}{\arabic{tagbcounter}*2*\hwidth-\seq_count:N \arg *\hwidth+\hwidth}
		\setcounter{tagccounter}{0}
		\seq_map_inline:Nn \argb {
			\stepcounter{tagccounter}
			\tagc{####1}{\arabic{tagccounter}}{2*\arabic{tagccounter}}{\arabic{tagbcounter}}
		}
		\stepcounter{tagbcounter}
	}
	#1
	\end{tikzpicture}
}
\ExplSyntaxOff
