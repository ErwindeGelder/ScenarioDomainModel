\section{Example}
\label{sec:example}

We will first explain the data that we use and how we use \ac{kde} to estimate the \ac{pdf}.
Next, we apply conditional sampling from the \ac{kde} according to \cref{alg:conditional simple,alg:conditional hard}.
Finally, we apply \cref{alg:constrained simple,alg:constrained hard} to sample from the \ac{kde} while the scenario parameters are subject to linear equality constraints.



\subsection{Data and \acp{kde}}
\label{sec:example data}

\cstarta We work with a data set obtained during an experiment in which 20 participants have driven a predefined route in The Netherlands.
The 50-kilometer route contained a variety of traffic elements, such as urban roads, motorways, junctions (with and without priority), pedestrian crossings, curvy road sections, traffic lights, speed bumps, etc.
The route took about 1 hour.
Because each participant drove the route thrice, the data set contains about 60 hours of driving.
Among other data, the speed of the participants was recorded.
As already done in \autocite{deGelder2017assessment, degelder2019completeness}, the speed was used to extract 2786 braking activities of the vehicle that is equipped with the sensors. \cenda
Each of the braking activities is described by $\dimension=3$ variables:
\begin{enumerate}
	\item the mean deceleration;
	\item the end speed; and
	\item the speed reduction.
\end{enumerate}

\cstarta To illustrate our method, we construct \iac{kde} of these parameters using the $\numberofsamples=2786$ data samples and sample a new set of parameters using the constructed \ac{kde}. \cenda
To apply \cref{alg:conditional simple,alg:constrained simple}, we employ \ac{kde} with the bandwidth matrix $\bandwidthmatrix=\bandwidth^2\identitymatrix{3}$. 
\cstarta The bandwidth $\bandwidth$ is determine using Silverman's rule of thumb \autocite{silverman1986density}, which results in $\bandwidth\approx 0.61$. \cenda

To illustrate \cref{alg:conditional hard,alg:constrained hard}, we use a full bandwidth matrix $\bandwidthmatrix$. 
The bandwidth matrix is estimated using the plug-in selector of \textcite{wand1994multivariate}. 
The resulting bandwidth matrix is:
\begin{equation*}
	\bandwidthmatrix \approx
	\begin{bmatrix}
		0.0058 & -0.032 & 0.021 \\
		-0.032 & 0.92 & -0.23 \\
		0.021 & -0.23 & 0.40
	\end{bmatrix}.
\end{equation*}



\subsection{Sampling with part of $\variable$ fixed}

In this first example, we want to sample the speed difference, while the average deceleration equals $\SI{1}{\meter\per\second\squared}$ and the end speed equals $\SI{10}{\meter\per\second}$. 
Thus, we have two variables fixed ($\dimensionparta=2$) and one variable that is unconstrained ($\dimensionpartb=1$).

In \cref{fig:conditional simple,fig:conditional hard}, the result of \cref{alg:conditional simple,alg:conditional hard} is shown, respectively. 
In total, $10^6$ samples are generated and shown by the histogram (the bin width is \SI{0.2}{\meter\per\second}). 
Because the histograms follow the same pattern as the actual density of the speed difference according to the \ac{kde}, it illustrates that the provided algorithms correctly sample from the \ac{kde}. 

\newcommand{\figurevspace}{\vspace{-1.2cm}}
\newcommand{\captionvspace}{\vspace{-1cm}}
\begin{figure}
	\figurevspace
	\centering
	\resizebox{\columnwidth}{!}{%
		\input{figs/conditional_simple.tikz}
	}
	\captionvspace
	\caption{The histogram shows the result of the conditional sampling according to \cref{alg:conditional simple}. The red line represents the true \ac{pdf}.}
	\label{fig:conditional simple}
\end{figure}

\begin{figure}
	\figurevspace
	\centering
	\resizebox{\columnwidth}{!}{%
		\input{figs/conditional_hard.tikz}
	}
	\captionvspace
	\caption{The histogram show the result of the conditional sampling according to \cref{alg:conditional hard}. The red line represents the true \ac{pdf}.}
	\label{fig:conditional hard}
\end{figure}



\subsection{Sampling with linear constraints}

In this second example, we want to sample the speed difference, while the average deceleration equals $\SI{1}{\meter\per\second\squared}$ and the start speed equals $\SI{15}{\meter\per\second}$. 
This means that we have
\begin{equation*}
	\constraintmatrix = \begin{bmatrix} 1 & 0 & 0 \\ 0 & 1 & 1 \end{bmatrix}, 
	\constraintvector = \begin{bmatrix} 1 \\ 15 \end{bmatrix}.
\end{equation*}
The \ac{svd} according to \cref{eq:svd constraint matrix} gives
\begin{align*}
	&\svdu = \begin{bmatrix} 0 & 1 \\ 1 & 0 \end{bmatrix},
	\svds = \begin{bmatrix} \sqrt{2} & 0 \\ 0 & 1 \end{bmatrix}, 
	\svdva^T = \begin{bmatrix} 0 & \frac{1}{2}\sqrt{2} & \frac{1}{2}\sqrt{2} \\ 1 & 0 & 0 \end{bmatrix},\\
	&\svdvb^T = \begin{bmatrix} 0 & -\frac{1}{2}\sqrt{2} & \frac{1}{2}\sqrt{2} \end{bmatrix}.
\end{align*}

In \cref{fig:constrained simple,fig:constrained hard}, the result of \cref{alg:constrained simple,alg:constrained hard} is shown, respectively. 
In total, $10^6$ samples are generated and shown by the histogram. 
Because the histograms follow the same pattern as the actual density of the speed difference according to the \ac{kde}, it illustrates that the provided algorithms correctly sample from the \ac{kde}. 

\begin{figure}
	\figurevspace
	\centering
	\resizebox{\columnwidth}{!}{%
		\input{figs/constrained_simple.tikz}
	}
	\captionvspace
	\caption{The histogram shows the result of the conditional sampling according to \cref{alg:constrained simple}. The red line represents the true \ac{pdf}.}
	\label{fig:constrained simple}
\end{figure}

\begin{figure}
	\figurevspace
	\centering
	\resizebox{\columnwidth}{!}{%
		\input{figs/constrained_hard.tikz}
	}
	\captionvspace
	\caption{The histogram shows the result of the conditional sampling according to \cref{alg:constrained hard}. The red line represents the true \ac{pdf}.}
	\label{fig:constrained hard}
\end{figure}
